# Disable automatic HTTPS since Cloudflare handles TLS
{
  auto_https off
}

:80 {
  # Excalidraw: draw.yourdomain.com
  @excalidraw host {$EXCALIDRAW_DOMAIN:draw.localhost}
  handle @excalidraw {
    handle /socket.io/* {
      reverse_proxy room:80
    }

    handle {
      basic_auth {
        {$EXCALIDRAW_USER:admin} {$EXCALIDRAW_PASSWORD_BASE64}
      }

      handle /storage/* {
        reverse_proxy storage:8080
      }

      handle {
        reverse_proxy app:80
      }
    }
  }

  # Mermaid Live Editor: mermaid.yourdomain.com
  @mermaid host {$MERMAID_DOMAIN:mermaid.localhost}
  handle @mermaid {
    basic_auth {
      {$EXCALIDRAW_USER:admin} {$EXCALIDRAW_PASSWORD_BASE64}
    }
    reverse_proxy mermaid:8080
  }

  handle {
    respond "Not Found" 404
  }
}
